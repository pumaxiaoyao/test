<div class="page-container">
    <div class="page-sidebar-wrapper">
        <div class="page-sidebar navbar-collapse collapse">
            <ul class="page-sidebar-menu" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
                <li class="sidebar-toggler-wrapper">
                    <div class="sidebar-toggler">
                    </div>
                </li>
                <li class="sidebar-search-wrapper">
                </li>
                <li class=""><a href="/site/index"><i class="icon-home"></i><span class="title">首页</span><span class="selected"></span></a></li><li class="start active open"><a href="javascript:;"><i class="icon-users"></i><span class="title">玩家管理</span><span class="arrow"></span></a><ul class="sub-menu"><li class="active"><a href="/player/online"><i class="icon-edit"></i>当前在线玩家</a></li><li class=""><a href="/player/list"><i class="icon-edit"></i>所有玩家列表</a></li><li class=""><a href="/player/regDaily"><i class="icon-edit"></i>今日注册玩家</a></li><li class=""><a href="/player/fundFlow"><i class="icon-edit"></i>玩家资金流水</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-diamond"></i><span class="title">玩家资金</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/playerFund/dptVerify"><i class="icon-edit"></i>存款审核</a></li><li class=""><a href="/playerFund/dptHistory"><i class="icon-edit"></i>存款历史查询</a></li><li class=""><a href="/playerFund/dptCorrection"><i class="icon-edit"></i>玩家资金调整</a></li><li class=""><a href="/playerFund/wtdVerify"><i class="icon-edit"></i>取款审核</a></li><li class=""><a href="/playerFund/wtdHistory"><i class="icon-edit"></i>取款历史查询</a></li><li class=""><a href="/playerFund/flowLimit"><i class="icon-edit"></i>取款流水限制汇总</a></li><li class=""><a href="/playerFund/transferList"><i class="icon-edit"></i>转账未知处理列表</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-note"></i><span class="title">优惠活动</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/activity/activity"><i class="icon-edit"></i>优惠活动管理</a></li><li class=""><a href="/activity/activityVerify"><i class="icon-edit"></i>活动审核管理</a></li><li class=""><a href="/activity/activityHistory"><i class="icon-edit"></i>活动审核历史</a></li><li class=""><a href="/activity/activityFund"><i class="icon-edit"></i>活动资金统计</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-note"></i><span class="title">流水及返水</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/flow/wagered"><i class="icon-edit"></i>玩家流水明细</a></li><li class=""><a href="/flow/grant"><i class="icon-edit"></i>发放玩家返水</a></li><li class=""><a href="/flow/history"><i class="icon-edit"></i>玩家返水历史</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-user"></i><span class="title">代理管理</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/agent/verify"><i class="icon-edit"></i>代理审核</a></li><li class=""><a href="/agent/list"><i class="icon-edit"></i>代理列表</a></li><li class=""><a href="/agent/verifyHistory"><i class="icon-edit"></i>代理审核历史</a></li><li class=""><a href="/agent/domain"><i class="icon-edit"></i>代理域名</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-diamond"></i><span class="title">代理资金</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/agentFund/curPeriod"><i class="icon-edit"></i>本期代理结算</a></li><li class=""><a href="/agentFund/settleHistory"><i class="icon-edit"></i>代理结算历史</a></li><li class=""><a href="/agentFund/wtdVerify"><i class="icon-edit"></i>代理取款审核</a></li><li class=""><a href="/agentFund/wtdHistory"><i class="icon-edit"></i>代理取款历史</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-notebook"></i><span class="title">银行资金管理</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/bank/cardList"><i class="icon-edit"></i>银行资金明细</a></li><li class=""><a href="/bank/bankPayment"><i class="icon-edit"></i>银行支付设置</a></li><li class=""><a href="/bank/merChant"><i class="icon-edit"></i>第三方平台设置</a></li><li class=""><a href="/bank/deposit"><i class="icon-edit"></i>存款对账管理</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-bell"></i><span class="title">系统消息</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/message/player"><i class="icon-edit"></i>玩家消息</a></li><li class=""><a href="/message/agent"><i class="icon-edit"></i>代理消息</a></li><li class=""><a href="/message/platform"><i class="icon-edit"></i>平台消息</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-settings"></i><span class="title">系统设置</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/settings/playerLevel"><i class="icon-edit"></i>玩家层级设置</a></li><li class=""><a href="/settings/agentLevel"><i class="icon-edit"></i>代理层级设置</a></li><li class=""><a href="/settings/gplist"><i class="icon-edit"></i>游戏平台设置</a></li><li class=""><a href="/settings/csDept"><i class="icon-edit"></i>客服部门设置</a></li><li class=""><a href="/settings/csAcct"><i class="icon-edit"></i>客服账号设置</a></li><li class=""><a href="/settings/ws"><i class="icon-edit"></i>系统参数设置</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-pie-chart"></i><span class="title">报表中心</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/report/companyDaily"><i class="icon-edit"></i>公司输赢报表</a></li><li class=""><a href="/report/agentDaily"><i class="icon-edit"></i>代理输赢日报</a></li><li class=""><a href="/report/platform"><i class="icon-edit"></i>游戏输赢汇总</a></li><li class=""><a href="/report/playerActivity"><i class="icon-edit"></i>玩家活跃度</a></li><li class=""><a href="/report/arbitrage"><i class="icon-edit"></i>套利查询</a></li></ul></li><li class=""><a href="javascript:;"><i class="icon-settings"></i><span class="title">前台网站配置</span><span class="arrow"></span></a><ul class="sub-menu"><li class=""><a href="/website/cf"><i class="icon-edit"></i>网站信息管理</a></li><li class=""><a href="/website/file"><i class="icon-edit"></i>图片文件上传库</a></li></ul></li>            </ul>
        </div>
    </div>
    <div class="page-content-wrapper">
        <div class="page-content" id="a_pageContent">
            <div class="portlet">
    <div class="portlet-title">
        <div class="caption">
            <i class="icon-globe"></i>当前在线玩家（online:<span id="playerTotal"></span>）
        </div>
    </div>
    <div class="portlet-body">
        <form action="/player/onlineAjax" id="s_search" class="form-inline" style="text-align:right;">
            <div class="form-group">
                <select name="s_type" id="s_type" class="table-group-action-input form-control input-inline input-sm"
                        tabindex="1">
                    <option value="1">账号</option>
                    <option value="2">姓名</option>
                    <option value="3">IP</option>
                    <option value="4">代理</option>
                </select>
            </div>
            <div class="form-group">
                <input name="s_keyword" id="s_keyword" type="text"
                       placeholder="关键词" class="table-group-action-input form-control input-inline input-sm"/>
            </div>
            <div class="form-group">
                <button type="submit" id="s_submit"
                        class="btn btn-sm green table-group-action-submit">
                    搜索 &nbsp; <i class="fa fa-search"></i>
                </button>
            </div>
        </form>
        <table
            class="table table-bordered table-striped table-condensed flip-content table-hover"
            id="data">
            <thead>
            <tr>
                <th></th>
                <th>账号</th>
                <th>姓名</th>
                <th>主账户余额</th>
                <th>玩家层级</th>
                <th>代理</th>
                <th>本次登陆IP/时间</th>
                <th>最后活跃时间</th>
                <th>在线时间</th>
                <th>上次登陆IP/时间</th>
                <th>登录域名</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script src="/js/support/player/player.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#s_search").search({
            "_fnCallback": function (resp) {
                $('#data tbody > tr').find('td:eq(3)').css('text-align','right');


                $("#playerTotal").text(resp.iTotalRecords);
                $('#data').find('label[attr=ip]').each(function(){
                    var tip = $(this);
                    var ip = $(this).html();
                    if(ip!=""&&ip!=null){
                        if(ip.indexOf(".")!=-1){
                            ip = ip.split(".");
                            ip = ip[0]+"."+ip[1]+"."+ip[2]+".1";
                            $.ajax({
                            url: '/site/getIpInfo',
                            type: 'get',
                            dataType: 'json',
                            data:{ip:ip},
                            cache:true,
                            error: function () {
                                
                            },
                            success: function (data) {
                                var text = '获取IP信息失败!';
                                if(data.code == 0){
                                    text = data.data['country']+data.data['region']+data.data['city'];
                                    if(data.data['region']+data.data['city']==""){
                                     $.ajax({
                                        url: '/site/getIpInfoTB',
                                        type: 'get',
                                        dataType: 'json',
                                        data:{ip:ip},
                                        cache:true,
                                        error: function () {

                                        },
                                        success: function (data) {
                                            tip.attr('flag',1);
                                            var text = '获取IP信息失败!';
                                            if(data.code == 0){
                                                text = data.data['country']+data.data['region']+data.data['city'];
                                            }
                                            var td = $(tip).parent();
                                            //$(td).css('width',180);
                                            $(td).find('label[attr=addr]').html(text);
                                     }});
                                    }
                                }
                                var td = $(tip).parent();
                                $(td).css('width',180);
                                $(td).find('label[attr=addr]').html(text);
                            }});
                        }
                    }
                });
            }
        });
    });
</script>        </div>
    </div>
    <!-- END CONTENT -->

</div>
<!-- END CONTAINER -->
