
    <div class="page-content-wrapper">
        <div class="page-content" id="a_pageContent">
            <style type="text/css">
    .line {
        margin-bottom: 20px;
    }

    /* 复制提示 */
    .copy-tips {
        position: fixed;
        z-index: 999;
        bottom: 50%;
        left: 50%;
        margin: 0 0 -20px -80px;
        background-color: rgba(0, 0, 0, 0.2);
        filter: progid:DXImageTransform.Microsoft.Gradient(startColorstr=#30000000, endColorstr=#30000000);
        padding: 6px;
    }

    .copy-tips-wrap {
        padding: 10px 20px;
        text-align: center;
        border: 1px solid #F4D9A6;
        background-color: #FFFDEE;
        font-size: 14px;
    }
</style>


<div class="portlet">
    <div class="portlet-title">
        <div class="caption">
            <i class="icon-globe"></i>网站文件管理（<font color=red>请上传”非中文“命名的“jpg,jpeg,gif,png“格式图片，大小不超过500k，或“mp3,wav”格式音频，大小不超过2M</font>）
        </div>
    </div>
    <div class="portlet-body">

                <form id="uploadfile" action="/kzb/mfile/transfer" method="post" enctype="multipart/form-data"
              class="form-inline" style="text-align:right;width:100%;">
            <div class="form-group">上传文件</div>
            <input type="hidden" name="pcate" id="pcate" value="image"/>
            <input type="hidden" name="scate" id="scate" value="adv"/>
            <input type="hidden" name="typeb" id="typeb" value="5000"/>
            <input type="hidden" name="types" id="types" value="5100"/>
            <input type="hidden" name="tosno" id="tosno" value="0"/>

            <div class="form-group">
                <input type="file" name="cover" class="form-control" id="cover"/>
            </div>

            <div class="form-group">
                <input type="text" name="remark" id="remark"
                       class="form-control input-inline" placeholder="请填写文件说明">
            </div>

            <div class="form-group">
                <button type="submit" id="s_submit"
                        class="btn btn-sm green table-group-action-submit">
                    上传文件&nbsp; <i class="fa fa-search"></i>
                </button>
            </div>
        </form>
                <form action="/website/fileListAjax" id="s_search" class="form-inline" style="text-align:right;">
        </form>
        <table class="table table-bordered table-striped table-condensed flip-content table-hover"
               id="data">
            <thead>
            <tr>
                <th>id</th>
                <th>类型</th>
                <th>描述</th>
                <th>访问路径(点击复制)</th>
                                    <th>预览</th>
                                    
                <th>上传时间</th>

                                <th>操作</th>
                            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="ViewModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-full">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="btn_cancel"
                        aria-hidden="true"></button>
                <h4 class="modal-title">预览</h4>
            </div>
            <div class="modal-body" style="text-align: center;vertical-align: middle;">
                <img id="view">
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>
</div>

<script type="text/javascript">
    function show(url) {
        $("#view").attr("src", url);
    }

    $("#cover").change(function () {
        //,wma,amr,act,msc
        if ("mp3,wav".indexOf($("#cover").val().substr($("#cover").val().indexOf('.') + 1).toLowerCase()) != -1) {
            $("#pcate").val("audio");
            $("#scate").val("cs");
            $("#typeb").val("5200");
            $("#types").val("5300");
        }

        if ("jpg,jpeg,gif,png".indexOf($("#cover").val().substr($("#cover").val().indexOf('.') + 1).toLowerCase()) != -1) {
            $("#pcate").val("image");
            $("#scate").val("adv");
            $("#typeb").val("5000");
            $("#types").val("5100");
        }
    });

    $('#uploadfile').ajaxForm({
        beforeSubmit: function (arr, $form, options) {
            if ($("#cover").val() == "") {
                $.notific8("请选择需要上传的文件", {theme: 'ebony'});
                return false;
            }
            if ($("#remark").val() == "") {
                $.notific8("请填写文件说明", {theme: 'ebony'});
                return false;
            }


            if ("mp3,wav,jpg,jpeg,gif,png".indexOf($("#cover").val().substr($("#cover").val().indexOf('.') + 1).toLowerCase()) == -1) {
                $.notific8("允许上传的格式为音频：mp3,wav 图片：jpg,jpeg,gif,png", {theme: 'ebony'});
                return false;
            }

            $.blockUI();
            return true;
        },
        error: function () {
            $.unblockUI();
        },
        success: function (data) {
            $.unblockUI();
            if (data.c != 0) {
                $.notific8(getError(data.c), {theme: 'ebony'});
            } else {
                $.notific8("上传成功");
                target[1].fnReloadAjax();
            }
        }
    });

    $(document).ready(function () {
        $("#s_search").search({
            '_fnCallback': function () {
                var client = new ZeroClipboard($('a.copy'));
                client.on("ready", function (readyEvent) {
                    client.on('copy', function (event) {
                        var text_id = $(event.target).attr('key');
                        var text = '//5af892e9a29d350a.g-cdn-s.com' + $('#' + text_id).text();
                        event.clipboardData.setData('text/plain', text);
                    });
                    client.on("aftercopy", function (event) {
                        $.notific8("复制成功");
                    });
                });
                client.on('error', function (event) {
                    ZeroClipboard.destroy();
                });
            }
        });
    });

    function deletefile(id) {
        if (confirm('警告：文件删除后将无法恢复。')) {
            $.blockUI();
            $.ajax({
                url: '/kzb/mfile/del',
                type: 'post',
                dataType: 'json',
                data: {id: id},
                cache: false,
                error: function () {
                    $.notific8("系统错误，请重试或联系管理员", {theme: 'ebony'});
                    $.unblockUI();
                },
                success: function (data) {
                    target[1].fnReloadAjax();
                    $.notific8("文件已删除");
                    $.unblockUI();
                }
            });
        }
    }
    //    [filecfg]
    // cateName = adv
    // parentCate = image
    // allowUpload = true
    // exts = jpg,jpeg,gif,png
    // maxSize = 2097152
    // savePath = /var/miracle_image/adv/
</script>
<script type="text/javascript" src="/js/zclip/ZeroClipboard.min.js"></script>
        </div>
    </div>
    <!-- END CONTENT -->

</div>
<!-- END CONTAINER -->
